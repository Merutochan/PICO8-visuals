pico-8 cartridge // http://www.pico-8.com
version 19
__lua__
stri = "🐱😐🐱😐🐱😐🐱😐🐱"

function toarr(s)
	b = {}
	for i = 1,#s do
		add(b,sub(s,i,i))
	end
	return b
end


modes = {'round','num','osc','gltch', 'perm', 'bw'}
string=toarr(stri)

function _init()
	bw=false
	alwayson=true
	msg=""
	jj=0
	mod=0
	a=0
	o=-1
	count=0
	bt = 0
	k = 0
	beat = {time(), time(), time(), time()}
	bpm = 120
	cx=64
	cy=64
	st={}
	for i=1,200 do
		add(st, star())
	end
	spb=0.5	
	mode={0,5,7,6}
	m=4
	n=3
	s1=0.9
	s2=0.2
	spb=1
	t=0
end


function _update60()
	l={}
	
	cx=64-32*cos(time()*bpm/210)
	cy=64-32*sin(time()*bpm/190)
	
	for i=1,#st do
		st[i].x += st[i].dx*bpm/10
		st[i].y += st[i].dy*bpm/10
		st[i].l = sqrt((st[i].x-64)*(st[i].x-64)+(st[i].y-64)*(st[i].y-64))
		if st[i].x < 0 or st[i].x > 128 or st[i].y < 0 or st[i].x > 128 then
			del(st,st[i])
			add(st, star())
		end
	end	
	
	-- controls
	if mod==0 then
		if btnp(2) then
			n+=1
			n=min(32,n)
		elseif btnp(3) then
			n-=1
			n=max(2,n)
		end
	elseif mod==1 then
		if btnp(2) then
			m+=1
			m=min(8,m)
		elseif btnp(3) then
			m-=1
			m=max(1,m)
		end
	elseif mod==2 then
		if btn(2) then
			a+=0.1
			a=min(16,a)
		elseif btn(3) then
			a-=0.1
			a=max(0,a)
		end
	elseif mod==3 then
		if btn(2) then
			jj=1
			msg="glitch on"
			o=time()
		elseif btn(3) then
			jj=0
			msg="glitch off"
			o=time()
		end
	elseif mod==4 then
	if btn(2) then
			alwayson=true
			msg="perm on"
			o=time()
		elseif btn(3) then
			alwayson=false
			msg="perm off"
			o=time()
		end
	elseif mod==5 then
	if btn(2) then
			bw=true
			msg="bw on"
			o=time()
		elseif btn(3) then
			bw=false
			msg="bw off"
			o=time()
		end
	end
	
	if btnp(1) then
		mod+=1
		mod=min(5,mod)
		msg=modes[mod+1]
		o=time()
	elseif btnp(0) then
		mod-=1
		mod=max(0,mod)
		msg=modes[mod+1]
		o=time()
	end
	
	
	-- points update
	for j=1,m do
		l[j]={}
		for i=0,n-1 do
			l[j][i]={}
			l[j][i].x=cx+4*cos(i/n+time()*bpm/200*s1+j/m)*(7+j%8)*(0.5+0.5*abs(sin(time()*bpm/100)))
			l[j][i].y=cy+4*sin(i/n+time()*bpm/200*s2-j/m)*(7+j%8)*(0.5+0.5*abs(sin(time()*bpm/100)))
		end
	end
	-- mirror mode
	if btnp(4) then
		t+=1
		poke(0x5f2c, mode[1+t%#mode])
	end
	-- bpm control
	if btnp(5) then
		msg = flr(bpm)
		o = time()
		bt=0
		k+=1
		beat[k%2+1] = time()
		spb = abs(beat[2] - beat[1])
		bps = 1/spb
		bpm = bps*60
	end
	-- time in bpm terms
	oldbt = bt
	bt = time()%(spb/4)
	if bt < oldbt then
		count+=1
		count=count%64
	end
end


function _draw()
	cls()
	
	if (flr(time()*bpm/4)%8>1 or alwayson) then
		-- draw starfield
		for i = 1,#st do
			col = i
			if bw then
				col=mode[col%4+1]
			end
			line(st[i].x, st[i].y, st[i].x+st[i].dx*st[i].l, st[i].y+st[i].dy*st[i].l, col)
		end
	end
	-- draw object
	if (count%4!=2 or alwayson) then
		r = 3*abs(cos(time()*bpm/220))	
		if (count<16) then
			circ(cx,cy,r*(n*1.3),7)
			circ(cx,cy,r*(n),7)
			circfill(cx,cy,r*(n*0.7),0)
			circfill(cx,cy,r*(n*0.5),7)
		elseif (count<32) then
			rect(cx-r*n*1.3,cy-r*n*1.3,cx+r*n*1.3,cy+r*n*1.3,7)
			rect(cx-r*n,cy-r*n,cx+r*n,cy+r*n,7)
			rectfill(cx-r*n*0.7,cy-r*n*0.7,cx+r*n*0.7,cy+r*n*0.7,0)
			rectfill(cx-r*n*0.5,cy-r*n*0.5,cx+r*n*0.5,cy+r*n*0.5,7)
			rectfill(cx-r*n*0.3,cy-r*n*0.3,cx+r*n*0.3,cy+r*n*0.3,0)
		elseif (count<64) then
			for i = 1, #string do
				print(string[i],cx+bpm/4*cos(time()*bpm/100+i/#string),cy-4+bpm/5*sin(time()*bpm/400+i/#string),7)
			end
		end
			for j=1,m do
				col= 8+ (time()+j%4)%8
				if bw then
					col=mode[flr(col+j)%3+2]
				end
				for i=0,n-1 do
					if i==n-1 then
						line(l[j][0].x,l[j][0].y, l[j][i].x,l[j][i].y,col)
						line(l[j][0].x+1,l[j][0].y+1, l[j][i].x+1,l[j][i].y+1,col)
						line(l[j][0].x-1,l[j][0].y-1, l[j][i].x-1,l[j][i].y-1,col)
					else 
						line(l[j][i].x,l[j][i].y,l[j][i+1].x,l[j][i+1].y,col)
						line(l[j][i].x+1,l[j][i].y+1,l[j][i+1].x+1,l[j][i+1].y+1,col)
						line(l[j][i].x-1,l[j][i].y-1,l[j][i+1].x-1,l[j][i+1].y-1,col)
					end
				end
			end
		end
		if (count%4==0) then
			for i=1,126 do
				glch=jj*flr(rnd(2))*rnd(64)
				memcpy(0x6000+i*64+a*sin(time()+i/64), 0x6000 + ((i+glch)*64)%0x2000, 64+a*sin(time()))
			end
		end
--	end
	-- show bpm
	if time()-o<1 then
		print(msg,0,0,7)
	end
end

-- make star
function star()
	s={}
	s.x = 64-16+rnd(32)
	s.y = 64-16+rnd(32)
	s.dx = sgn(s.x-64)*sqrt((s.x-64)*(s.x-64))/100
	s.dy = sgn(s.y-64)*sqrt((s.y-64)*(s.y-64))/100
	s.l = sqrt((s.x-64)*(s.x-64)+(s.y-64)*(s.y-64))
	return s
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
0000000000000000000f000000000000000000000000000000000006f30000000000e00000070000000000000000000000000000000000030000000000e00000
00000000000000000000f00000000000000000000000000000000006f30000000000e0000007000000000000000000000000000000000030000000000e000000
00000000000000000000f00000000000000000000000000000000006fc000000000000000000000000000000000000000000000000000300000000000e000000
000000000000000000000f00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000e0000000
000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000e00000000
000000000000000000000000000000000000000000000000000000000c000400000000000000000000000000000000000000000000000000000000e000000000
000000000000000000000000000000000000000000000000000000000c00040000000000000000000000000000000000000000000000000000000e0000000000
000000000000000000000000000000000000000000000000000000000c0004000008000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000c000400000800000000000000000000000000000000000000a000000000000000000000
000000000000000000000000000000000000000000000000000000000000040000080000000000000000000000000000000000000a0000000000000000000000
00000000000000000000000000000000000000000000000000000000000004000008000000000000000000000000000000000000a00000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000a00000000000000000000000
0000000000000000000000000000000000000000000000008000000000000000000800000000000000000500000000000000000a000000000000000000000000
000000000000000000000000000000000000000000000000800000000000000000000000000000000000050000000000000000a00000000000e0000000000000
00000000200000000000000000000000000000000000000008000000000000000000000000000000000050000000000000000a00000000000e00000000000000
000000000200000000000000000000000000000000000000080000d00000000000000000000000000000500000000000000000000000000ee000000000000000
000000000022000000000000000000000000000000000000080000d0000000000000000000000000000500000000000000000000000000e00000000000000000
0000000000002000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000e000000000000000000
0000000000000200000000007000000000000000000000000000000d0000000000000000000000000000000000000000000000000000e0000000000000000000
0000000000000020000000000700000000000000000000000000000d00000000000000000000000000000000000000b000000000000000000000000000000000
0000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000
000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000b0000000000000000000000000000000000
200000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000b0000000000000000000000000000000000
02000000000000000000000000000500000000000000000000000000600000000000000000000000000000000000b09000000000000000000000000000000000
002200000000000000000000000000500000d0000000000000000000060000000000000000000008000000000000090000000000000000000000000000000000
0000220000000000000000000000000500000d000000000000000000060000000000000000000008000000000000090000000000000000000000000000000000
0000002000000000000000000000000000100d000000000000000000000000000000000000000080000000000000900000000000000000000000000000000000
00000000000000000000000000000000000100d00000000000000000000000000000000000000080000000000009000000000000000000000000000000000000
000000000000000000000000000000000000100d0000000000000000000000000000000000000000000000000090000000000000000000000000000000000004
000000000000000000000000000000000000100d600000000000000000000000000000000000000000000e000090000000000000000000000000000000000440
0000000000000000000000000000000000000100d60000000000000000000000000000000000000000000e000900000000000000000000000000000000044000
000000000000000000000000000000000000001006000000000000000000000000000000000000000000e0000000000000000000000000000000000000400000
0000000000000000000000000000000000000001006000000000f000000000000000000000000000000000000000000000000000000000000000000000000006
0000000000000000000000000000000000000000006000000000f000000000000000000000b00000000000000000000000000000000000000000000000000660
00000000000000000000000000000000000000000006000000000f00000000000000000000b00020000000000000000000000000000000000000000000066000
00000000000000000000000000b00000000000000000000000000f00000000000000000009000020000000000000000000000000000000000000000006600000
900000000000000000000000000b00000000000000000000000000f0000000000000d00009000200000000000000000000000000000000000000000000000000
0000000000000000000000000000bb000000000000000000000000f0000000000000d00009000000000000000000000000000000000000000000000000000000
ff0000000000000000000000000000b000000000000000000000000000000000000d000000000000000000030000000000000000000000000000000000000000
00ff000000000000000000000000000b00000000000000000000000000000000000d000000000000000000300000000000000000000000000000000000000000
0000ff00000000000400000000000000000000000000000000000000000000900000000000000000000003000000000000000000000000000000000000000000
000000ff0000000000440000007000000000000000000f0000000000000000909000000000000000000030000000000000000000000000000000000000000000
0000000000000000000044000007700000000000000000f000000000000000905000080000000000060000000000000000000000000000000000000000000000
000000000000000000000000000007700000000000000000000a0000000003905000080000000000060000e00000000000000000000000000000000000000000
0000000000000000000000000000000700000000000000000000a0000000030050008000000000006000ee000000000000000000000000000000b00000000000
00000000000000000000000000000000000000000000000000000a00000000305000000000000000600e0000000000000000000000000000000b0b0000000000
000000000000000000000000000000000000000000000000000000a00000003040000000000000060000000000000000000000000000000000bbb0b000000000
0000000000000000000000000000000000000000000000000000000a000000004000000000000000000000000000000000000000000000000bbbbb0000000000
0000000000000000000000000000000000000000000000000000000aaa000000000000000000000000000000220000000000000000000000bbbbbb0000000000
00000000000000000000000000000000000000000000000000000000aaa0000000000000000000000000002200000000000550000000000b0bbbb00000000000
000000000000000000000000000000002200000000000000000000000aaa00000000000000000000000000000000000005500000000000b0b0bb000000000000
00000000000000000000000000000000002200000000000000000000a0a0a000000000000000000000300000000000055000000000000b0b0b0b000000000ccc
000000000000000000000000000000080000220000000000000000000a0a0a0000000000000000000300000000000000000000000000b0bbb0b0900000000000
00000000000000000000000000000000880000000b000000000000000000a0a00000000000000000000000000000000000000000000b0bbbbb09090000000000
000000000000000000000000000000000000000000bb0000000000000000ea0a000000000000000000000000000000000000000000bdbbbb9b90900000000000
000000000000000000000000000000000000000000000000000000600000e0a0a000888800000000cc08088800000000000000000bdbbbb9b999000000000000
000000000000000000000000000000000000000000000000000000060000a0888888088880000000088000000000000000000000b0b0bb9b9990000002220000
00000000000000000000000000000000000000000000c000000000000008880888888088880000000000000000002200fff0000b0b0b0bb99900002220000000
000000000000000000000000000000000000000000000c00001000000000888088888800008000000000000000000000000000b0b0b0b0b99000000000000000
00000000000000000000000000000000000000000000000000710000000008880a00aa0000880000011100000000000000000b0b9bbb0b090000000000000000
000000000000000000000000000000000000000000000000607000000000008000a00aa00008800000000000000000000000b0b9bb9bb0900000000000000000
00000000000000000000000000000000000000000000000006000000000b0008000a00aa000080000000000000000009999b0b9bb9b9b9000000000000000333
0000000000000000000000000000000000000cccc000000000000000000000008000a000a0000800000000000000000000b0b9b9bb9b90000000000000000000
000000000000000000000000000000000000000000000000000000000000000008800a000a00008000000000000000000b0b0b9b9bb900000000000000000000
0000000000000000000000000000000000000000000000000000000000000000008800a000a000080000000000000000b0b0b0b9b0b000000000000000000000
0000000000dddddd0000000000000000000000000000000000000000000000000008800a000a0000800000000000000b0b0b09bb0b0000000000000000000000
00000000006666600000000000000000000000000000001100000000000000000000080aa000a80088000000000000b9b0b09b9bb00000000000000000000000
0000000000000000000000000000000000000011111c0000000000000000000000000080aa000a000880000000000b9b9b09b9b9b00000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000088a000fa0008000000000b9b9b990bb9b000000000000022220000000
00000000000000000000000000000000000000000002220000000000000000004000000080a0000aa0080000000b9b9b990b0bb0000000000000000002220000
00000000000000000000000000000000000000000000000000000000000000d040000000080a0000aa00800000b0b9b990b0b0b0000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000dd80a0000aa008000b0b0b990b0b0b00000000000111111000000000
0cccccccbb0000000000000000000000000000000000000000000000000000000000000000080a00000a0789b7b0b0909bb0b000000000000000000000000000
0000000000000000000000000000000000000000aa000020000000000700000000000000000080a00007a0989b7b0909b9bb0000000000000000000000000000
000000000000000000000000000000000000000000002200000070000100000000000000000008aa00700ab889b0909b9b0b0000000000000000000000000000
0000000000000000000000000000000000000000000000000007000000000000000000000000008aa7099bab8879090bb0b00000000000000000000000000000
000000000000000000000000000e00000000000000000000000000000000000c00000000000000088797b9bab89797b0bb000000000000000000000000000000
0000000000000000000000000ee00000000000000000000b00000000000000c00000000000000000887b0b9ba9897b7b0b000000000000000000000000000000
00000000000000000000000000000000000000003000000b0000000000000000c0000000000000009880b7b77a989bb0b0000000000000000000000000000000
00000000000000000000000000000000000000330000000000000000000f0000c0000000000000009b780b7797aa80bb0000000ee000000a4440000000000000
00000000000000000000000055000000000f330000000020000000b0000f00000000000000000009b9b0877979bba87b000000000ee000000aa4440000000000
0000000000000000000000550000300033f0000000002200000000b000f00000000000000000009b9b9b08979b9bb88000000000000000000000000000000000
00000000000000000000000000330033000000000000000000000b000000000000000000000000b9b9b70989b9b7bb8800000000000000000000000000000000
00000000000000000000000000003300000000000000000000000000000000000000000000000b0b9b7190b89b7b070800000000000000000000000000000000
000000000000000000000000000b0000000000000000000000000000000000f0000000000000b0b0b0791b7b87b0700080099000000000000000000000000000
0000000000000000000000000bb00000000000000000000000000000000000f000000000000b9b0bc097b0b0b877000008000990000000000000000000000000
000000000000000000000000b000000000000000000000000000000000000f000000000000b9b9b009bb0b7b7a80050000800000000000000000000000000000
0000000000000000000000bb0000000000000000000000000040000000000000000000000b9b9b909b9bb0b000a8405000080000000000000000000000000000
000000000000000000000b00000000009000000000000000040000000000000000000000b0b9b909b9b9bb00000a840550088000000000000000000000000000
00000000000000000000000000000099000000000000500004000000700000000000000b0b0b90bb9b9b00000000a88005008800000000000000000000000000
0000000000000000000000000000000000000000000500004000000700000000000000b0b0b09b0bb9b0000000000a88005008aa000000000000000000000000
000000000000000000000000000000000000000000050000000000070000000000000b0b9b09b0b0bb000000000000a88000008aa00000000000000000000000
00000000000000000000000000000000000000000050000000000070000000000000b0b9b9bb0b0b00000000000000aaf8000008aa0000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000b0b9b9b9bb0b0000000000000000aaf80008080a000000000000000000000
000000000000000000000000000000000000000000000000000a00000000000000b0b9b9b9b9bb000000000000000000a0f80008880a00000000000000000000
000000000000000000000000000000000000000000000000000a0000000000000b0b0bbb9b9b900000000000000000000a00800aaa8aa0000000000000000000
00000000000000003000000000000000000000000000000000a0000000000000b0b0bb9bb9b90000000000000000000000aaa8a0aa88aa000000000000000000
00000000000000330000000000000000000000000000000000a000000000000b0b0bb9b9bb9070000000000000000000000aaa8a0aa88aa00e00000000000000
0000000000003300000000000000000000030000000000000a000000000040b0b0bb9b9b09007000000000a0000000000000aaa8a066808000ee000000000000
0000000008e30000000000000000000000300000000000000a00000000004b0b0b9bb9b7900007000000000a0000000000000500800068000000ee0000000000
000000088e000000000000000000000003000000e0000000000000000000b0b0b9b9bb09000007000000000a000000000000005008000680000000e000000000
000000800050000000000000000000000000000e0000000000000000000b4bbb0b9b90970000000000000000a000000000000000008000680000000000000000
00f088005500000000000000000000000000000e000000000000000000b0bbbbb9b9090000000000000000000000000000000000000880008000000000000000
ff080005000000000000000000000000000000e000000000000000000b0bbbb9bb99900000000000000000000050000000000000000088008800000000000000
00000550000000000000000000000000000000e00000000000000000b0bbbb0b9999000000000000000000000005000000000000000008800880000000000005
0000500000000000000000000000000000000e00000000000000000b0b0bb0b09990000000000000000000000005000000000000000000080080000000000000
0000000000000000000000000000000000000e0000000000010000b0b0b0bb090900000000000000000000000000500000000000000000008008000000000000
000000000000000000000000000000000000e0000000000001000bbb0b0b00009000000000000000000000000000500000000000000000000800800000000000
0000000000000000000000000000000000000000000000001000bbbbb0b000000000000000000000000000000000000000000000000000000080080000000000
000000000000000000000000000000000000000000000000100bbbbbbb0000000000000000000000000000000000000000000000000004000008008000000000
00000000000000000000000000000000000000000000000000bbbbbb0000a0000000000000000000000000000000000000000000000000400000808800000000
0000000000000000000000000000000000000000000000000b0bbbb00000a0000000000000000000000000000000000000000000000000040000080880000000
00005000000000000000000000000000000000000000000000b0bb000000a0000000000000000000000000000000000000000d00000000004000008080000000
000500000000000000000000000000000000000000000000000b0000000a000000000000000000000000000000000000000000d0000000000400000808000000
05500000000000000000000000000000000000000000000900000000000a000000000000000000100000000000000000000000d0000000000040000080800000
5000000000000000000000000000000000000000000000090000000000000000000000000000090100000000000000000000000d000000000000000008880000
00000000000000000000000000000000000000000000009000000000000000000000000000000901060000000000000000000000d00000000000000000888000
00000000000000000000000000000000000000000000009000000000000000000000000000000900160000000000000000000000d00000000000000000088800
000000000000000000000000000000000000000000000900000000000000000000000000000009001060000000000000000000000d0000000000000000000880
00000000000000000000000000000000000000000000000000000000000000000000000000000090006000000000000000000000000000000000000000000088
000000000000000000000000000700000000000000000000000000000000000000000000000000900006000700000000000000000000000000c0000000000008
000000000000000000000000007000000000000000000000000000000b000000000000000000009000060007000000000000000000000000000c000000000000
000000000000006000000000007000000000000000000000000000000b0000000000000000000000000000007000000000000000000000000000c00000000000
000000000000060000000000070000000000000000000000000000000b00000000000000000000000000000070000000000000000000000000000c0000000000
000000000000600000000000700000000000000000000000000000000b000000000000000000000000000000700000000000000000000000000000c000000400
00000000000600000000000070000000000000000000000000000000b00000000000000000000000000000000700000000000000000000000000000c00000040
00000000000600000000000700000000000000000000000000000000b000000000000000000000000000000007000000000000000000000000000000c0000004
00000000006000000000000000000000000000000000000000000000b0000000000000000000000000000000000000000000000000000000000000000c000000

