pico-8 cartridge // http://www.pico-8.com
version 19
__lua__
sq = sqrt(2)/2*128
pl=7
n=12
m=64
balls=4
md = {0,5,6,7}
fx=0
fx_list={'ball','speed','mirror','circle','color','particle', 'wave'}
function _init()
	w=0
	t3 = time()
	sw1=0
	sw2=false
	sw3=false
	sp=20
	cx=64
	cy=64
	t=0
	l={}
	a={}
	b={}
	-- circles
	for i=1,n do
		add(l, q(i*128/n,7))
	end
	-- particles
	for i=1,m do
		add(a, s())
	end
end

function _update60()
	-- update center
	cx=64+(sp/2)*cos(time()/sp)
	cy=64+(sp/2)*sin(time()/(sp*3))	
	-- update circles
	for i=1,#l do
		l[i].r+=l[i].a
		if (l[i].r>=sq) then
			del(l, l[i])
			if #l<=n-1 then
				add(l, q(0, 1+14*cos(time()/8)))
			else
				break
			end
		end
	end
	-- update particles
	for i=1,#a do
		a[i].x += a[i].vx
		a[i].y += a[i].vy
		if (a[i].x>128 or a[i].x<0 or a[i].y>128 or a[i].y<0) then
			del(a, a[i])
			if #a<=m-1 then
				add(a, s())
			else
				break
			end
		end
	end
	if fx==0 then
 	-- change num of balls
 	if btnp(2) then
 		balls+=1
 		balls=min(balls,16)
 	elseif btnp(3) then
 		balls-=1
 		balls=max(balls,0)
 	end
 	-- change speed
 elseif fx==1 then
 	if btnp(2) then
 		sp+=0.1
 	elseif btn(3) then
 		sp-=0.1
 	end
 -- change mirror mode
 elseif fx==2 then
 	if btnp(2) then
 		sw1 = (sw1+1)%4
			poke(0x5f2c, md[sw1+1])
 	elseif btnp(3) then
 		sw1 = (sw1-1)%4
			poke(0x5f2c, md[sw1+1])
 	end
 -- change number of circles
 elseif fx==3 then
 	if btnp(2) then
 		n+=1
 		n=min(24,n)
 		if #l<n then
				add(l, q(0, 1+14*cos(time()/8)))	
			end
 	elseif btnp(3) then
 		n-=1
 		n=max(0,n)
 	end
 	-- change pl (color value)
 elseif fx==4 then
 	if btnp(2) then
 		pl+=1
 		pl = min(pl,16)
 	elseif btnp(3) then
 		pl-=1
 		pl = max(0,pl)
 	end
 -- change n of particles
 elseif fx==5 then
 	if btnp(2) then
 		m+=1
 		m = min(m,128)
 		if #a < m then
				add(a, s())	
			end
 	elseif btnp(3) then
 		m-=1
 		m = max(0,m)
 	end
	-- wave amount
 elseif fx==6 then
 	if btnp(2) then
 		sw3 = true
 		w+=1
 		w = min(16,w)
 	elseif btnp(3) then
 		w-=1
 		w=max(0,w)
 		if w==0 then
	 		sw3 = false
	 	end
 	end
 end
 -- switch fx
 if btnp(1) then
 	fx+=1
 	fx=min(fx,6)
 	t3=time()
 elseif btnp(0) then
 	fx-=1
 	fx=max(fx,0)
 	t3=time()
 end
 
	-- dot 
	if btnp(5) then
		sw2=true
		t2=time()
	end
end

function _draw()
	-- clear screen
	if not btn(4) then
		cls()
	elseif sw2 then
		if (time()-t2)>2 then
			sw2=false
		end
	end
	-- render circles
	for i=1,#l do
		circ(c.x, c.y, l[i].r, l[i].c)
	end
	-- render particles
	for i=1,#a do
		pset(a[i].x, a[i].y, 7)
	end
	-- render center
	circfill(cx,cy,8,0)
	-- render balls
	for i=1,balls do
		x=48*cos(sin(time()/(sp*0.7))+time()/(sp*1.5)+i/balls)
		y=48*sin(cos(time()/(sp*1.1))+time()/sp-i/balls)
		size=1+4*abs(cos(time()/sp+i/balls))
		circfill(cx+x, cy+y, size, 7)
	end
	-- wave effect
		if (sw3) then
		for i=1,126 do
			dst = 0x6000+64*i+w*cos(time()+i/32+w/16)
			src= 0x6000+64*i
 		memcpy(dst,src, 64)
 	end
 end
 -- font must be white
	pset(-1,-1,7)
	if sw2 then
		print('.')
	end
	if time()-t3 < 0.5 then
		print(fx_list[fx+1])
	end
end

-- circles
function q(r,cl)
	c={}
	c.x = cx
	c.y = cy
	c.r = r
	c.c = cl
	c.a = 1+rnd(2)
	return c
end
-- particles
function s()
	p={}
	p.x = cx
	p.y = cy
	p.vx = 8*((rnd(2))-1)
	p.vy = 8*((rnd(2))-1)
	return p
end
__label__
000000000000000000000dd00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00dd0000
00000000000000000000d00ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ee00d000
0000000000000000000d00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00d00
000000000000000000d00e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00d0
00000000000000000d00e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e07d
0000000000000000d00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00
000000000000000d00e0000000000000000000000000000000000000000000000aaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000e7
00000000000000d00e000000000000000000000000000000000000000000aaaaa000000000000000aaaaa000000000000000000000000000000000000000000e
0000000000000d00e000000000000000000000000000000000000000aaaa0000000000000000000000000aaaa000000000000000000000000000000000000000
000000000000d00e0000000000000000000000000000000000000aaa000000000000000000000000000000000aaa000000000000000000000000000000000000
00000000000d00e000000000000000000000000000000000000aa000000000000000000000000000000000000000aa0000000000000000000000000000000000
0000000000d00e0000000000000000000000000000000000aaa0000000000000000000000000000000000000000700aaa0000000000000000000000000000000
0000000000d0e000000000000000070000000000000000aa0000000000000000000000000000000000000000007770000aa00000000000000000000000000000
000000000d0e000000000000000000000000000000000a00000000000000000000000000000000000000000007777700000a0000000000000000000000000000
00000000d00e0000000000000000000000000000000aa0000000000000000000000000000000000000000000077777000000aa00000000000000000000000700
0000000d00e000000000000000000000000000000aa00000000000000000000000000000000000000000000007777700000000aa000000000000000000000000
0000000d0e000000000000000000000000000000a000000000000000000000000099999999999990000070000077700000000000a00000000000000000000000
000000d0e000000000000000000000000000070a0000000000000000000009999900000000000009999900000000000000000000070000000000000000000000
00000d00e0000000000000000000000000000aa0000000000000000000999000000000000000000000009990000000000070000000aa70000000000000000000
00000d0e0000000000000000000000000000a00000000000000000099900000000000000000000000000000999000000000000000000a0000000000000000000
0000d0e0000000000000000000000000000a000000000000000009900000000000bbbbbbbbbbbbb000000000009900000000000000000a000000000000000000
000d00e000000000000000000000000000a00000000000000009900000000bbbbb0000000000000bbbbb00000000990000000000000000a00000000000000000
000d0e000000000000000000000000000a000000000000000990000000bbb00000000000000000000000bbb000000099000700000000000a0000000000000000
00d0e000000000000000000000000000a00000000000000990000000bb00000000000000000000000000000bb00000009900000000000000a000000000000000
00d0e00000000000000000000000000a0000000000000090000000bb000000000000000000000000000000000bb0000000900000000000000a00000000000000
0d0e00000000000000000000000000a0000000000000090000007b0000000000000000000000000000000000000bb000000900000000000000a0000000000000
0d0e0000000000000000000000000a00000000000009900000bb00000000000000000000000000000000000000000bb00000990000000000000a000000000000
d0e0000000000000000000000000a00000000000009000000b000000000000000000000000000000000000000000000b00000090000000000000a00000000000
d0e0000000000000000000000007a000000000000900000bb00000000000000000000000000000000000000000000000bb000009000000000000a00000000000
0e0000000000000000000000000a000000000000900007b000000000000000000000000000000000000000000000700000b000009000000000000a0000000000
0e000000000000000000000000a000000000000900000b00000000000000000000000000000000000000000000000000000b000009000000000000a000000000
e000000000000000000000000a000000000000900000b0000000000000000000000999999999990000000000000000000000b000009000000000000a00000000
e000070000000000000000000a00000000000900000b000000000000000000099990000000007099990000000000000000000b00000900000000000a00000000
e00000000000000000000000a00000000000900000b00000000000000000999000000000000000000099900000000000000000b00000900000000000a0000000
000000000000000000000000a0000000000090000b0000000000000000990000000000000000000000000990000000000000000b0000900000000000a0000000
00000000000000000000000a0000000000090000b000000000000000990000000000000000000000000000099000000000000000b0000900000000000a000000
0000000000000000000000a0000000000090000b00000000000000090000000000099999999999000000000009000000000000000b0000900000000000a00000
0000000000000000000000a000000000090000b0000000000000009000000000999000000000007990000000009000000000000000b000090000000000a00000
000000000000000000000a0000000000090000b0000000000000990000000999000000000000000009990000000997000000000000b0000900000000000a0000
000000000000000000000a000000000090000b000000000000090000000990000000000000000000000099000000090000000000000b000090000000000a0000
000000000000000000000a00000000009000b00000000000009000000090000000008888888880000000009000000090000000000000b00090000000000a0000
00000000000000000000a000000000090000b00000000000090000000900000008880000000008880000000900000009000000000000b000090000000000a000
00000000000000000000a00000000009000b0000000000009000000990000088800000000000000088800000990000009700000000000b00090000000000a000
0000000000000000000a000000000090000b0000000000009000009000000800000000000000000000080000009000009000000000000b000090000000000a00
0000000000000000000a00000000009000b000000000000900000900000880000000777777777000000088000009000009000000000000b00090000000000a00
0000000000000000000a00000000090000b000000000009000009000008000000777888888888777000000800000900000900000000000b00009000000000a00
000000000000000000a00000000009000b00000000000900000090000800000770880000000008807700000800009000000900000000000b00090000000000a0
000000000000000000a00000000009000b00000000000900070900008000007088000000000000088070000080000900000900000000000b00090000000000a0
000000000000000000a0000000009000b0000000000090000090000800000778000000000000000008870000080000900000900000000000b0009000000000a0
000000000000000000a0700000009000b0000000000090000900008000007800000000000000000000087000008000090000900000000000b0009000000000a0
00000000000000000a00000000009000b0000000000900000900008000078000000000000000000000008700008000090000090000000000b00090000000000a
00000000000000000a0000000009000b000000000009000090000800007800000000000000000000000008700008000090000900000000000b0009000000000a
00000000000000000a0000000009000b000000000009000090008000078000000000000000000000000000870000800090000900000000000b0009000000000a
00000000000000000a0000000009000b000000000090000090008000708000070700000000000000000000807000800090000090000000000b0009000000000a
00000000000000000a0000000009000b000000000090000900008000780000000000000000000000000000087000800009000090000000000b0077700000000a
0000000000000000a00000000009000b000000000090000900080007080000000000000000000000000000080700080009000090000000000b77777770000000
0000000000000000a0000000009000b0000000000090000900080007800000000000000000000000000000008700080009000090000000000077777770000000
0000000000000000a0000000009000b0000000000900009000080007870000000000000000000000000000008700080000900009000000000777777777000000
0000000000000000a0000000009000b0000000000900009000800078000000000000000000000000007070000870008000900009000000000777777777000000
0000000000000000a0000000009000b0000000000900009000800078000000007000000000000000000000000870008000900009000000000777777777000000
0000000000000000a0000000009000b0000000000900009000800078000000000000000000000000000000000870008000900009000000000077777770000000
0000000000000000a0000000009000b0000000000900009000800078000000000000000000000000000000000870008000900009000000000077777770000000
0000000000000000a0000000009777b00000000009000090008000780000000000000000000000000000000008700080009000090000000000b0777000000700
0000000000000000a0000000077777770000000007000090008000780000000000000000000000000070000008700080009000090000000000b0009000000000
0000000000000000a0000000077777770000000009000090008000780000000000000000000000000000000008700087009000090000000000b0009000000000
0000000000000000a0000000777777777000000009000090008700780000000000000000000000000000000008700080009000090000000000b0009000000000
0000000000000000a0000000777777777000000009000090008000780000000000000000000000000000000008700080009000090000000000b0009007000000
0000000000000000a0000000777777777000000009000090000800078000000000000000000000000000000087000800009000090000000000b0009000000000
0000000000000000a0000000077777770000000000900009000800078000000000000000000000000000000087000800090000900000000000b0009000000000
0000000000000000a000000007777777000000000090007900080007080000000000000000000000000000080700080009000097000000000b00090000000000
00000000000000000a0000000007770b000000000090000900008000780000000000000000000000000000087000800009000090000000000b0009000000000a
00000000000000000a0000000009000b000000000090000090008000708000000000000000000000000000807000800090000090000000000b0009000000000a
00000000000000000a0000000009000b000000000009000090008000078000000000000000000000000000870000800070000900000000000b0009000000000a
00000000000000000a0000000009000b000000000009000090000800007800000000000000000000000008700008000090000900000000000b0009000000000a
00000000000000000a00000000009000b0000000000900000900008000078000000000000000000000008700008000090000090000000000b00090000000000a
000000000000000000a0000000009000b0000000000090000900008000007800000000000000000000087000008000090000900000000000b0009000000000a0
000000000000000000a0000000009000b0000000000090000090000800000788000000000000000008870000080000900000900000000000b0009000000000a0
000000000000000000a00000000009000b00000000000900000900008000007087000000000000088070000080000900000900000000000b00090000000000a0
000000000000000000a00000000009000b00000000000900000090000800000770880000000008807700000800009000000900000000000b00090000000000a0
0000000000000000000a00000000090000b000000000009000009000008000000777888888888777000000800000900000900000000000b00009000000000a00
0000000000000000000a00000000009000b000000000000900000900000880000000777777777000000078000009000009000000000000b00090000000000a00
0000000000000000000a000000000090000b0000000000009000009000000800000000000000000000080000009000009000000000000b000090000000000a00
00000000000000000000a00000000009000b0000000000009000000990000088800000000000000088800000990000009000000000000b00090000000000a000
00000000000000000000a000000000090000b00000000000090000000900000008880000000078880000000900000009000000000000b000090000000000a000
000000000000000000000a00000000009000b00000000000009000000090000000008888888880000000009000000090000000000000b00090000000000a0000
000000000000000000000a000000000090000b000000000000090000000990000000000000000000000099000000090000000000000b000090000000000a0000
000000000000000000000a0000000000090000b0000000000000990000000999000000000000000009990000000990000000000000b0000900000000000a0000
0000000000000000000000a000000000090000b0000000000000009000000000999000000000009990000000009000000000000000b000090000000000a00000
0000000000000000000000a0000000000090000b00000000000000090000000000099999999999000000000009000000000000000b0000900000000000a00000
00000000000000000000000a0000000000090000b000000000000000990000000000000000000000000000099000000000000000b0000900000000000a000000
000000000000000000000000a0000000000090000b0000000000000000990000000000000000700000000990000000000000000b0000900000000000a0000000
e00000000000000000000000a00000000000900000b00000000000000000999000000000000000000099900000000000000000b00000900000000000a0000000
e000000000000000000000000a00000000000900000b000000000000000000099990000000000099990000000000000000000b00000900000000000a00000000
e000000000000000000000000a000000000000900000b0000000000000000000000999999999990000000000000000000000b000009000000000700a00000000
0e000000000000000000000000a000000000000900000b00000000000000000000000000000000000000000000000000000b000009000000000000a000000000
0e0000000000000000000000000a000000000000900000b000000000070000000000000000000000000000000000000000b000009000000000000a0000000000
d0e0000000000000000000000000a000000000000900000bb00000000000000000000000000000000000000000000000bb000009000000000007a00000000000
d0e0000000000000000000000000a00000000000009000000b000000000000000000000000000000000000000000000b00000090000000000000a00000000000
0d0e0000000000000000000000000a00000000000009900000bb00000000000000000000000000000000000000000bb00000990000000000000a000000000000
0d0e00000000000000000000000000a000000000000009000000bb0000000000000000000007000000000000000bb000000900000000000000a0000000000000
00d0e00000000000000000000000000a0000000000000090000000bb000000000000000000000000000000000bb0000000900000000000000a00000000000000
00d0e000000000000000000000000000a00000000000000990000000bb00000000000000000000000000000bb00000009900000000000000a000000000000000
000d0e000000000000000000000000000a000000000000000990000000bbb00000000000000000000000bbb000000099000000000000000a0000000000000000
000d00e000000070000000000000000000a00000000000000009900000000bbbbb0000000000000bbbbb00000000990000000000000000a00000070000000000
0000d0e0000000000000000000000000000a000000000000000009900000000000bbbbbbbbbbbbb000000000009900000000000000000a000000000000000000
00000d0e0000000000000000000000000000a00000000000000000099900000000000000000000000000000999000000000000000000a0000000000000000000
00000d00e0000000000000000000000000000aa0000000000000000000999000000000000000000000009990000000000000000000aa00000000000000000000
000000d0e000000000000000000000000000000a00000000000000000000099999000000000000099999000000700000000000000a0000000000000000000000
0000000d0e000000000000000000000000000000a000000000000777000000000099999999999990000000000000000000000000a00000000000000000000000
0000000d00e000000000000000007000000000000aa00000000077777000000000000000000000000000000000000000000000aa000000000000000000000000
00000000d00e0000000000000000000000000000000aa0000000777770000000000000000000000000000000000000000000aa00000000000000000000007000
000000000d0e000000000000000000000000000000000a00000077777000000000000000000000000000000000000000000a0000000000000000000000000000
0000000000d0e000000000000000000000000000000000aa0000077700000000000000000000000000000000000000000aa00000000000000000000000000000
0000000000d00e0000000000000000000000000000000000aaa0000000000000000000000000000000000000000000aaa0000000000000000000000000000000
00000000000d00e000000000000000000000000000000000000aa000000000000000000000000000000000000000aa0000000000000000000000000000000000
000000000000d70e0000000000000000000000000000000000000aaa000000000000000000000000000000000aaa000000000000000000000000000000000000
0000000000000d00e000000000000000000000000000000000000000aaaa0000000000770000000000000aaaa000000000000000000000000000000000000000
00000000000000d00e000000000000000000000000000000000000000000aaaaa000000000000000aaaaa000000000000000000000000000000000000000000e
000000000000000d00e0000000000000000000700000000000000000000000000aaaaaaaaaaaaaaa0000000000000000000000000000000000000000000700e0
0000000000000000d00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00
00000000000000000d00e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00d
000000000000000000d00e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00d0
0000000000000000000d00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00d00
00000000000000000000d00ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ee00d000
000000000000000000000dd00e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00dd0000
00000000000000000000000d00e0000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000e00d000000
000000000000000000000000d00ee000000000000000000000000000007000000000000000000000000000000000000000000000000000000000ee00d0000000
0000000000000000000000000dd00e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00dd00000000

