pico-8 cartridge // http://www.pico-8.com
version 19
__lua__
n = 50
floor = 16
ts = 128
clrs = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}

function _init()
	switch = false
	txt = {}
	tst = {}
--	tst = {'meru', 'kenobit', 'ick', 'nero', 'chiptune'}

	a = 5*9.81
	l = {}
	for i=1,#tst do
		add(txt, ct(tst[i] ,rnd(120), 64+rnd(64)-floor))
	end
	for i = 1,n do
		add(l, cc())
	end
	t0=time()
end

function _update60()

	t1 = time()
	-- update positions
	foreach(l, uc)
	for i=1,#txt do
		foreach(txt[i], ut)
	end
	t0=time()
	-- move up/down bar or balls
	if btn(2) then
		if switch then
			floor +=1
		else
			for i=1,#l do
				l[i].vy += -50*(1/l[i].r)
			end
			for i=1,#txt do
				for j=1,#txt[i] do
					txt[i][j].vy += -5
				end
			end
		end
	end
	if btn(3) then
		if switch then
			floor-=1
		else
			for i=1,#l do
				l[i].vy += 50*(1/l[i].r)
			end
			for i=1,#txt do
				for j=1,#txt[i] do
					txt[i][j].vy += 5
				end
			end
		end
	end
	-- move left/right
	if btnp(1) then
		for i=1,#l do
		 l[i].vx += 50*(1/l[i].r)
		end
		for i=1,#txt do
			for j=1,#txt[i] do
				txt[i][j].vx += 5
			end
		end
	end
	if btnp(0) then
	 for i=1,#l do
	 	l[i].vx += -50*(1/l[i].r)
	 end
	 for i=1,#txt do
 	 for j=1,#txt[i] do
				txt[i][j].vx += -5
			end
		end
	end

	-- switch
	if btn(4) then
	 switch=true
	else
		switch = false
	end

	if btn(5) then
		if switch then
			for i=1,#l do
				l[i].x += min(-1,(l[i].r-6))*(i/#l)*2*cos(time()+i/#l)
				l[i].y += (i/#l)*3*sin(time()+i/#l)
			end
		else 
			for i=1,#l do
				l[i].r += (cos(time()+i/#l))
				l[i].r = max(2, l[i].r)
				--l[i].c = clrs[flr(cos(i*time()))+1%#clrs]
				l[i].y = min(l[i].y, 128-floor-l[i].r)
			end
		end
	end
end

function _draw()
	cls()
	for i=1,#l do
		circfill(l[i].x,l[i].y,l[i].r,l[i].c)
		circ(l[i].x, l[i].y, l[i].r, 0)
	end
	-- text
	for j=1,#txt do
		for i=1,#txt[j] do
	--		print(txt[j][i].c, txt[j][i].x-2, txt[j][i].y-2, 2)
	--		print(txt[j][i].c, txt[j][i].x-1, txt[j][i].y-1, 1)
		print(txt[j][i].c, txt[j][i].x, txt[j][i].y, 5+5*abs(cos(time()/ts*i)))
		end
	end
	-- water mirror
	for i=0,floor do
		o = rnd(1)+cos(i/floor+time())
		src = 0x6000+64*(128-2*floor)+64*i+o
		dst = 0x7fff - 64*(i+1)
		val = min(64-o, 64)
		memcpy(dst, src, val)
	end
end

function cc()
	c = {}
	c.x = 16+rnd(102)
	c.y = 64+rnd(64)-floor
	c.c = clrs[flr(rnd(#clrs))]
	c.r = 3+rnd(8)
	c.at = 1/c.r
	c.vy= 0
	c.vx= 32*(rnd(2)-1)
	return c
end

function ct(tx, x, y)
	t = {}
	vx = 64*(rnd(2)-1)
	for i = 1,#tx do
		c = {}			
		c.c = sub(tx,i,i)
 	c.x = x
 	c.y = y
 	c.at = 0
  c.vy = 0
 	c.vx = vx
  x += 4
  add(t, c)
 end
 return t
end

function uc(c)
	-- velocity and position
	-- update
	c.vy += a*(t1-t0)
	c.y += c.vy*(t1-t0)
	c.x += c.vx*(t1-t0)
	-- ceiling collision
	if (c.y-c.r<0 and c.vy<0) then
		c.y = c.r
		c.vy *= -(1-c.at)
	end
	-- floor collision
	if (c.y+c.r>=128-floor and c.vy>0) then
		c.y = 127-floor-c.r
		c.vy *= -(1-c.at)
	end
	-- left/right wall collision
	if (c.x+c.r>=128 and c.vx>0) then
		c.x = 128-c.r
		c.vx *= -(1-c.at)
	end
	if (c.x-c.r<=0 and c.vx<0) then
		c.x = c.r
		c.vx *= -(1-c.at)
	end
end

function ut(c)
-- velocity and position
	-- update
	c.vy += a*(t1-t0)
	c.y += c.vy*(t1-t0)
	c.x += c.vx*(t1-t0)
	-- ceiling collision
	if (c.y<0 and c.vy<0) then
		c.y = 0
		c.vy *= -(1-c.at)
	end
	-- floor collision
	if (c.y+8>=128-floor and c.vy>0) then
		c.y = 127-floor-8
		c.vy *= -(1-c.at)
	end
	-- left/right wall collision
	if (c.x+4>=128 and c.vx>0) then
		c.x = 128-4
		c.vx *= -(1-c.at)
	end
	if (c.x-4<=0 and c.vx<0) then
		c.x = 4
		c.vx *= -(1-c.at)
	end
end
__gfx__
00777700077777000777770007777000077777000777770000777700070007000777777007000770007000000700007007000070007777000777700000777700
07000070070007000700000007000700070000000700000007000000070007000000700007007000007000000700007007700070070000700700070007000070
07000070070007000700000007000700070000000700000007000000070007000000700007070000007000000770077007070070070000700700070007000070
07777770077770000700000007000700077777000777770007000000077777000000700007700000007000000707707007070070070000700777700007000070
07000070070007000700000007000700070000000700000007077000070007000000700007070000007000000700007007007070070000700700000007000070
07000070070007000700000007000700070000000700000007000700070007000700700007007000007000000700007007007070070000700700000007007070
07000070070007000700000007000700070000000700000007000700070007000700700007000700007000000700007007000770070000700700000007000700
07000070077770000777770007777000077777000700000000777700070007000777000007000070007777000700007007000070007777000700000000777070
07777000007777700000000000000000000000000000000000000000070000700777777000000000000000000000000000000000000000000000000000000000
07000700070000000777777007000070070000700700000707000070070000700000007000000000000000000000000000000000000000000000000000000000
07000700070000000007700007000070070000700700000707700770077007700000070000000000000000000000000000000000000000000000000000000000
07777000007700000007700007000070070000700700000700777700007777000000700000000000000000000000000000000000000000000000000000000000
07700000000077000007700007000070070000700700000700077000000770000007000000000000000000000000000000000000000000000000000000000000
07070000000000700007700007000070007007000070007000777700000770000070000000000000000000000000000000000000000000000000000000000000
07007000000000700007700007000070007007000070707007700770000770000770000000000000000000000000000000000000000000000000000000000000
07000700077777000007700000777700000770000007070007000070000770000777777000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000055555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000055555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000099999000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000009999999990000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000099999999999000000000000000000000000000000000000000000000000000000000033333000000000000000
000000ccccc000000000000000000000000000999999999999900000000000000000000000000000000000000000000000000000003333333330000000000000
0000ccccccccc0000000000000000000000000999999999999900000000000000000000000000000000000000000000000000000033333333333000000000000
000ccccccccccc000000000000000000000009999999999999990000000000000000000000000000000000000000000000000000033333333333000000000000
000ccccccccccc000000000000000000000009999999999999990000000000000000000000000000000000000000000000000000333333333333300000000000
00ccccccccccc0000000000000000000000009999999999999990000000000000000000000000000000000000000000000000000333333333333300000000000
00cccccccccc0ddddd00000000000000000009999999999999990000000000000000000000000000000000000000000000111000333333333333300000000000
00ccccccccc0ddddddd0000000000000000009999999999999990000000000000000000000000000000000000000000001111100333333333333300000000000
00cccccccc0ddddddddd000000000000000000999999999999900000000000000000000000000000000000000000000011111110333333333333300000000000
00ccccccc0ddddddddddd00000000000000000999999999999900000000000000000000000000000000000000000000011111110033333333333000000000000
000cccccc0ddddddddddd00000000000000000099999999999000000000000000000000000000000000000000000000011111110033333333333000000000000
000cccccc0ddddddddddd00000000000000000009999999990000000000000000000000000000000000000000000000001111100003333333330000000000000
0000ccccc0ddddddddddd000000000000000055500999990000000ccc00000000000000000000000000000000000000000111000000033333000000000000000
000000ccc0ddddddddddd00000000000000055555000000000000ccccc0000000000000000000000000000000000000000000000000000000000000000000000
00000000000ddddddddd000000000000000055555000000000000ccccc0000000000000000000000000000000000000000000000000000088888000000000000
000000000000ddddddd0000000000000000055555000000000000ccccc0000000000000000000000000000000000000000000000000000888888800000000000
0000000000000ddddd000000000000000000055500000eee000000ccc00000000000000000000000000000000000000000000000000008888888880000000000
00000000000000000000000000000000000000000000eeeee0000000000000000000000000000000000000000000000000000000000008888888880000000000
00000000000000000000000000000000000000000000eeeee0000000000000000000000000000000000000000000000000000000000008888888880000000000
00000000000000000000000000000000000000000000eeeee0000000000000000000000000000000000000000000000000000000000008888888880000000000
000000000000000000000000000000000000000000000eee00000000000000000000000000000000000000000000000000000000000008888888880000000000
00000000000000000000000000eee000000000000000000000000000000000000000000000000000000000000000000000000000000000888888800000000000
0000000000000000000000000eeeee00000000111110000000000000000000000000000000000000000000000000000000000000000000088888000000000000
0000000000000000000000000eeeee0000d011111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000eeeee00dd0111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000eee000dd0111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000dd01111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000dd01111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000ddd01111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000999990000000ddd01111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000099999999900000ddd01111111111111000000000000000000000000000000000000000777770000000000000000000000000000000000000
000000000000000999999999990000dddd0111111111110000000000000000000000000000000000000077777777700000000000000000000000000000000000
0000000000222099999999999990c0dddd0111111110000000000000000000000000000000000000007777777777777000000000000000000000000000000000
0000000022222099999999999990cc0dd00000001009999900000000000000000000000000000000007777777777777000000000000000000000000000000000
00000022220000099999999999990c000aaaaaa00999999999000000000000000000000000000000077777777777777700000000000000000000000000000000
00000022004444400999999999990c0a00000a09999999999999000000000000000000000eee0000077777777777777705000000000000000000000000000000
00000200444444444009999999990000bbbbb0099999999999990000000000000000000eee005550777777777777777770000000000000000000000000000000
000000444444444444409999999900bbbbbbb099999999999999900000000888888800eee0555550777777777777777770500000000000000000000000000000
0000204444444444444099999990bbbbbbbbb0999999999999999000000888888888880e05555550777777777777777770500000000000000000000000000000
0000044444444444444409999990bbbbbbbb09999999999999999900008888888888888055555550777777777777777770500000000000000000000000000000
00000444444444444444099990000000bbbb09999999999999999900088888888888888805555550777777777777777770500000000000000009999900000000
0000444444444444444440900888888800bb09999999999999999900888888888888888880055555077777777777777705500000000000000999999999000000
00004444444444444444400888888888880b09999999999999999900888888888888888880505555077777777777777705500000000000009999999999900000
00004444444444444444408888888888888009999999999999999908888888888888888888050555507777777777777055506600000000099999999999990000
00004444444444444444088888888888888800999999999999999008888888888888888888050555507777777777777055066660000000099999999999990000
00004444444444444440888888888888888880999999999999999008888888888888888888055055070077777777700555000006000000999999999999999000
00000444444444444440888888888888888880099999999999990508888888888888888888055050777700777770055500555550000000999999999999999000
00000444444444444408888888888888888888099999999999990508888888888888888888055007777777000005555055555555500000999999999999999000
00000044444444444408888888888888888888000999999999005508888888888888888888055007777777777705550555555555550000999999999999999000
0000a0444444444444088888888888888888880bb009999900555508888888888888888888055007777777777705500555555555550000999999999999999000
000aaa004444444440088888888888888888880bb09000005555555088888888888888888055050777777777770000555555500055500a099999999999990000
00aaaaaa00444440060888888888888888888800099990555555550088888888888888888055050777777777770000555550099900500a099999999999990000
00aaaaaaaa000006660888888888888888888809999990555555550808888888888888880550555077777777700000555550999990500aa09999999999900000
00aaaaaaaaaaa0666608888888888888888888099999905555555088808888888888888050055555077777770000005555099999990000aa0999999999000000
00aaaaaaaaaaa0666660888888888888888880999999990555555088880888888888880000005555507777700000005555099999990000aaa009999900a00000
00aaaaaaaaaaa06666608888888888888888809999999005555550888880088888880000000000000000000000000005550999999900000aaaa00000aa000000
000aaaaaaaaa0066666608888888888888880999999990005555508888888000000080060000000000000000000000055550999990000000aaaaaaaaa0000000
0000aaaaaaa0906666666088888888888880999999990000005550888888888888888066000000000000000000000000555009990000000000aaaaa000000000
00000aaaaa0990066666660888888888880999999990000000000008888888888888066600000000000000000000000000555000000000000000000000000000
00000000009900066666666008888888009999999900000000055508888888888888066600000000000000000000000000000000000000000000000000000000
00000099999000006666666660000000c09999990000000000005550888888888880666000000000000000000000000000000000000000000000000000000000
00000000000000006666666660ccccccc00000000000000000005555088888888806660000000000000000000000000000000000000000000000000000000000
00000000000000000066666660ccccccc00000000000000000000055500888880000000000000000000000000000000000000000000000000000000000000000
000000000000000000006666600ccccc000000000000000000000000555000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000ccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000006666600ccccc00000000000000000000000055500000000000000000000000000000000000000000000000000000000000000000000000
0000000000000066666660ccccccc000000000000000000000555008888800000000000000000000000000000000000000000000000000000000000000000000
0000000000006666666660ccccccc000000000000000000055550888888888066600000000000000000000000000000000000000000000000000000000000000
0099999000006666666660000000c099999900000000000055508888888888806660000000000000000000000000000000000000000000000000000000000000
00000099000666666660088888880099999999000000000555088888888888880666000000000000000000000000000000000000000000000000000000000000
0aaaaa09900666666608888888888809999999900000000000088888888888880666000000000000000000000000005550000000000000000000000000000000
aaaaaaa0906666666088888888888880999999990000005550888888888888888066000000000000000000000000555009990000000000aaaaa0000000000000
0aaaaaaaaa0066666608888888888888880999999990005555508888888000000080060000000000000000000000055550999990000000aaaaaaaaa0000000aa
aaaaaaaaa06666608888888888888888809999999005555550888880088888880000000000000000000000000005550999999900000aaaa00000aa00000000aa
aaaaaaaaa0666660888888888888888880999999990555555088880888888888880000005555507777700000005555099999990000aaa009999900a0000000aa
aaaaaaaaa0666608888888888888888888099999905555555088808888888888888050055555077777770000005555099999990000aa099999999900000000aa
aaaaaa000006660888888888888888888809999990555555550808888888888888880550555077777777700000555550999990500aa099999999999000000000
aaaaaa00444440060888888888888888888800099990555555550088888888888888888055050777777777770000555550099900500a09999999999999000000
0aaa004444444440088888888888888888880bb09000005555555088888888888888888055050777777777770000555555500055500a09999999999999000000
a0444444444444088888888888888888880bb0099999005555088888888888888888880550077777777777055005555555555500009999999999999990000000
00004444444444440888888888888888888800099999999900550888888888888888888805500777777777770555055555555555000099999999999999900000
00044444444444440888888888888888888809999999999999050888888888888888888805500777777700000555505555555550000099999999999999900000
04444444444444408888888888888888800999999999999905088888888888888888880550507777007777700555005555500000009999999999999990000000
00444444444444444088888888888888888099999999999999900888888888888888888805505507007777777770055500000600000099999999999999900000
00444444444444444408888888888888880099999999999999900888888888888888888805055550777777777777705506666000000009999999999999000000
00444444444444444440888888888888800999999999999999990888888888888888888805055550777777777777705550660000000009999999999999000000
004444444444444444400888888888880b0999999999999999990088888888888888888050555507777777777777770550000000000000999999999990000000
00444444444444444440900888888800bb0999999999999999990088888888888888888005555507777777777777770550000000000000099999999900000000
00000444444444444444099990000000bbbb09999999999999999900088888888888888805555550777777777777777770500000000000000009999900000000
00044444444444444409999990bbbbbbbb0999999999999999990000888888888888805555555077777777777777777050000000000000000000000000000000
0000204444444444444099999990bbbbbbbbb0999999999999999000000888888888880e05555550777777777777777770500000000000000000000000000000
000000444444444444409999999900bbbbbbb099999999999999900000000888888800eee0555550777777777777777770500000000000000000000000000000
00000200444444444009999999990000bbbbb0099999999999990000000000000000000eee005550777777777777777770000000000000000000000000000000
00000022004444400999999999990c0a00000a09999999999999000000000000000000000eee0000077777777777777705000000000000000000000000000000
00000022220000099999999999990c000aaaaaa00999999999000000000000000000000000000000077777777777777700000000000000000000000000000000
0000000022222099999999999990cc0dd00000001009999900000000000000000000000000000000007777777777777000000000000000000000000000000000
0000000000222099999999999990c0dddd0111111110000000000000000000000000000000000000007777777777777000000000000000000000000000000000
0000000000000999999999990000dddd011111111111000000000000000000000000000000000000007777777770000000000000000000000000000000000000
000000000000000099999999900000ddd01111111111111000000000000000000000000000000000000000777770000000000000000000000000000000000000
000000000000000000999990000000ddd01111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000ddd0111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000dd0111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000dd0111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000eee000dd0111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000eeeee00dd0111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000eeeee0000d01111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000eeeee0000000011111000000000000000000000000000000000000000000000000000000000000000000008888800000000000000

