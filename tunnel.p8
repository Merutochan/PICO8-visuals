pico-8 cartridge // http://www.pico-8.com
version 19
__lua__
n=10
d=24
dep=.7
a=1
b=0
asin=false
count=0

function _init()
 cx=64
 cy=64
 mi = {}
 for i=0,d do
 	add(mi, k(i))
 end
end


function _update60()
	-- tunnel
	for i = 1,#mi do
		flag=false
		ra = rnd(0.5)-0.25 +0.1*(cos(time()/2))
		for j=1,#mi[i] do
			-- tunnel oscillation
			mi[i][j][1] += 0.1*cos(time()/16+j/#mi[i])+(ra+ (i/d)*0.2*sin(time()/11))
			mi[i][j][2] += 0.1*cos(time()/16+j/#mi[i])+(ra + (i/d)*0.5*sin(time()/20))

			-- zoom in the tunnel
			if j==1 then
				mi[i][j][1]-=dep
				mi[i][j][2]-=dep
			elseif j==2 then
				mi[i][j][1]+=dep
				mi[i][j][2]-=dep
			elseif j==3 then
				mi[i][j][1]+=dep
				mi[i][j][2]+=dep
			elseif j==4 then
				mi[i][j][1]-=dep
				mi[i][j][2]+=dep
			end
			-- check out of screen
			if ((mi[i][j][1]<128 and mi[i][j][1]>0)or(mi[i][j][2]<128 and mi[i][j][2]>0)) then
				flag = true
			end
		end
		-- del out of screen
		if (flag==false) then
			del(mi, mi[i])
			add(mi, k(d))
			count+=1
			break
		end
	end
	
	-- keys control
	if btn(2) then
	 a+=0.001
	 a=min(1.1,a)
	end
	if btn(3) then
	 a-=0.001
	 a=max(0.5,a)
	end
	
	-- automate
	if btnp(4) then asin=not asin end
	if asin then
		a = 0.8 + 0.3*sin(time()/15)
	end
end


function _draw()
	-- clear screen
	if not btn(5) then
		cls()
	end
	

 -- draw tunnel
 for i=1,#mi-1 do
 	for j=1,#mi[1] do
 		line(mi[i][j][1],mi[i][j][2],mi[i+1][j][1],mi[i+1][j][2],1+i+count+time())
 	end
 end
 
 -- tunnel effect
 for i=1,#mi do
 	for j=1,#mi[i] do
 		if j==#mi[i] then
 			line(mi[i][j][1],mi[i][j][2], mi[i][1][1], mi[i][1][2],i+count+time()%16)
 		else
 			line(mi[i][j][1],mi[i][j][2], mi[i][j+1][1], mi[i][j+1][2],i+count+time()%16)
 		end
 	end
 end
 	
end

function p(r)
	ce = {}
	co = rnd(16)
	for j = 1,m do
		pu = {}
		pu.x = cx+r*cos(j/m)
		pu.y = cy+r*sin(j/m)
		pu.c = co
		pu.oldx = pu.x
		pu.oldy = pu.y
		add(ce, pu)
	end
	return ce
end

function k(v)
	mp1 = {64/d*v,64/d*v*a}
	mp2 = {128-64/d*v, 64/d*v*a}
	mp3 = {128-64/d*v,128-64/d*v*a}
	mp4 = {64/d*v, 128-64/d*v*a}
	w = {mp1, mp2, mp3, mp4}
	return w
end
__label__
070080900a000bdc00e0000120000000011111111000000000000000000000000000000000000000000000000000000000fe00000dc00000a090000860070500
07008090a0000bdc00e00001ffffff00000000000111111111110000000000000000000000000000000000000000000000fe00000dc00000a090000860070500
07008090a0000bdc00e00001f20000ffffffffffff0000000000111111111111000000000000000000000000000000000f0e00000dc00000a090000860075000
07008090a0000bdc00e00001f02000000000000000ffffffffffff0000000000111111111110000000000000000000000f0e00000dc00000a090000860075000
07008090a0000bdc00e00001f02000000000000000000000000000fffffffffff0000000000111111111111000000000f00e00000dc00000a090000860705000
07008090a000b0dc00e00001f0020000000000000000000000000000000000000ffffffffffff000000000011111100f000e00000dc00000a090000860705000
70008090a000b0d000e00001f0002000000000000000000000000000000000000000000000000ffffffffffff000100f000e00000dc00000a090000860705000
70008090a000b0d000e00001f0002000000000000000000000000000000000000000000000000000000000000fff10f0000e00000dc00000a090008060705000
70008090a000b0d000e00001f000020000000000000000000000000000000000000000000000000000000000000210f0000e00000dc00000a090008060705000
70008090a000b0d00e000001f000033333300000000000000000000000000000000000000000000000000000002010f0000e00000dc0000a0090008060705000
70008090a000b0d00e000001f000034000033333333333000000000000000000000000000000000000000000002010f0000e00000dc0000a0090008060705000
70008090a000b0d00e000001f000030222222220000000333333333330000000000000000000000000000000002010f0000e00000dc0000a0090008060705000
70008090a000b0d00e000001f000030244444402222222222222200003333333333300000000000000000000020010f0000e00000dc0000a0090008060705000
70008090a000b0d00e000001f000030245000044444444440000022222222222222033333333333000000000020010f0000e0000d0c0000a0090008060705000
70008090a000bdc00e000010f000030245000000000000004444444444400000000222222222222333333300200010f0000e0000d0c0000a0090008060705000
70008090a000bdc00e000010f000030240500000000000000000000000044444444440000000000002223222200010f0000e0000d0c0000a0090008060705000
70008090a000bdc00e00001f0000030240050000000000000000000000000000000004444444444000003000200010f000e00000d0c0000a0090008060705000
70008090a000bdc00e00001f0000030240050000000000000000000000000000000000000000000444444000200010f000e00000d0c0000a0090008060705000
70008090a000bdc00e00001f0000030240005000000000000000000000000000000000000000000000054000200010f000e00000d0c0000a0090008060705000
70008090a000bdc00e00001f0000030240000500000000000000000000000000000000000000000000054000200010f000e00000d0c0000a0900008060705000
70008090a000bdc00e00001f0000030240000500000000000000000000000000000000000000000000504000200100f000e00000d0c0000a0900008060705000
70008090a000bdc00e00001f0000030240000055555555000000000000000000000000000000000000504000200100f000e00000d0c0000a0900008060705000
70008090a000bdc00e00001f0000030240000056000000555555555555550000000000000000000005004000200100f000e00000d0c0000a0900008060705000
70008090a000bdc00e00001f0000030240000056000000000000000000005555555555555500000005004000200100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f0000030240000050600000000000000000000000000000000055555550004000200100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f0000030240000050600000000000000000000000000000000000000050004000200100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f0000030240000050066666660000000000000000000000000000000650004000200100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f0000300240000050067000006666666666660000000000000000000650004000200100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f0000300240000050060700000000000000006666666666660000006050004002000100f000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006070000000000000000000000000000666666605000400200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006007000000000000000000000000000000000605000400200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006000700000000000000000000000000000007605000400200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006000070000000000000000000000000000007605003400200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006000070000000000000000000000000000007605003400200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006000007000000000000000000000000000070605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000005006000000777777700000000000000000000070605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050006000000780000077777777777777000000700605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050006000000780000000000000000000777777700605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050006000000708888888000000000000000000700605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050060000000708900000888888888888000008700605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050060000000708900000000000000000888888700605004000200010f0000e00000dc00000a0900008060705000
70008090a000bdc00e00001f000030240000050060000000708099999999990000000000998700605004000200010f0000e00000dc00000a0900008060705000
7008090a000b0dc0e000010f00003024000005006000000070809a000000009999999999008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e000010f00003024000005006000000070809a000000000000000009008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e000010f000030240000050060000000708090a000000000000000a9008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e00001f00000302400000500600000070080900a00000000000000a9008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e00001f00000302400000500600000070080900a0000000000000a09008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e00001f000003024000005006000000700809000aaaaaaa000000a09008706005004000200010f0000e00000dc00000a0900008060705000
0008090a000b0d00e00001f000003024000005006000000700809000ab00000aaaaaa009008706005004000200100f0000e00000dc00000a0900008060705000
0008090a000b0d00e00001f000003024000005006000000700809000ab0000000000a009008706005004000200100f000e00000dbc00000a0900008060705000
0008090a000b0d00e00001f000003024000005006000000700809000a0b00000000ba009008706005004000200100f000e00000d0c00000a0900008600705000
0008090a000b0d00e00001f000003024000005006000000700809000a00b0000000ba009008706005004000200100f000e00000d0c0000a00900008600705000
0008090a000b0d00e00001f000003024000005006000000700809000a00b000000b0a009008706005004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000700809000a000b00000b0a009008706050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000700809000a0000b000b00a009008706050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000700809000a00000b00b00a009008706050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000700809000a00000b0b000a009008706050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000708090000a000000bb000a009008706050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f000003024000005006000000708090000a000000bb000a009008006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00000302400000500600000070809000a0000000cc000a090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00000302400000500600000070809000a0000000cc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00000302400000500600000070809000a0000000cc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003002400000500600000070809000a0000000cc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003004000000506000000070809000a0000000cc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003004000005006000000070809000a000000bcc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003024000005006000000700809000a000000bcc00a0090087006050004002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003024000005006000000700809000a000000bcc00a0090087060050034002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003024000005006000000700809000a000000bcc00a0090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000b0d00e00001f00003024000005006000000700809000a000000bcc00a0090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000bdc00e00001f00003024000005006000000700809000a000bbbbbb00a0090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000bdc00e00010f00003024000005006000000700809000aaaaaaa000bba0090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000bdc00e00010f000030240000050060000007008090aa0000000aaaaaa0090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000bdc00e00010f000030240000050060000007008099999000000000000a090087060050040002000100f000e00000d0c0000a00900080607050000
0008090a000bdc00e00010f0000302400000500600000070089000009999999999000a9008706005004000200010f0000e00000d0c0000a00900080607050000
0008090a000bdc00e0001f0000030240000050060007777778888888000000000099999008706005004000200010f0000e00000d0c0000a00900080607050000
0008090a000bdc0e00001f0000030240000050066666660000077777888888888888000998706005004000200010f0000e00000d0c0000a00900080607050000
0008090a000bdc0e00001f0000030240000056600000006666666666660007777777888888706005004002000100f0000e00000d0c0000a00900080607050000
0008090a000bdc0e00001f0000030240000555555555000000000000006666666666667777706005004002000100f0000e00000d0c0000a00900080607050000
0008090a000bdc0e00001f0000030240555000000000555555555555550000000000006666666005004002000100f0000e00000d0c0000a00900080607050000
0008090a00b0dc0e00001f0000033344444440000000000000000000005555555555555500000665004002000100f0000e00000dc00000a00900080607050000
0008090a00b0d00e00001f0000003200003334444444444444000000000000000000000055555555004002000100f0000e00000dc00000a00900080607050000
0008090a00b0d00e00001f0000003200000000000000000033444444444444400000000000000000504002000100f0000e00000dc00000a00900080607050000
0008090a00b0d00e00001f0000022222222000000000000000000000000000344444444444440000054002000100f000e000000dc00000a00900080607050000
000809a000b0d00e00001f0222200000000222222222220000000000000000000000000000004444444002000100f000e000000dc00000a09000080607050000
000890a000b0d00e0000111111000000000000000000002222222222220000000000000000000000000302000100f000e000000dc00000a09000080607050000
000890a000b0d00e00000f0000111111111111000000000000000000002222222222200000000000000032000100f000e00000dbc00000a09000080607050000
000890a000b0d00e0000000000000000000000111111111110000000000000000000022222222222000032000100f000e00000dbc00000a09000080607050000
008090a000b0d00e00000f0000000000000000000000000001111111111110000000000000000000222222000100f000e00000d0c00000a09000080607050000
008090a000b0d00e00000ffffff00000000000000000000000000000000001111111111100000000000000200100f000e00000d0c00000a09000080607050000
008090a000b0d00e000ff000000ffffffffffff00000000000000000000000000000000011111111111100022100f000e00000d0c00000a09000080607050000
008090a000b0d00e0ff00000000000000000000ffffffffffff00000000000000000000000000000000011111100f000e00000d0c00000a09000080607050000
008090a000b0d00eeeeee000000000000000000000000000000ffffffffffff00000000000000000000000000000f000e00000d0c00000a09000080607050000
008090a000b0d0e000000eeeeeeeeeeee000000000000000000000000000000ffffffffffff00000000000000000f000e00000d0c0000a009000080607050000
008090a000b0d0e000000000000000000eeeeeeeeeee0000000000000000000000000000000ffffffffffff00000f000e00000d0c0000a009000080607050000
008090a000b0de000000000000000000000000000000eeeeeeeeeeee0000000000000000000000000000000ffffff000e00000d0c0000a009000080607050000
008090a000b0de000000000000000000000000000000000000000000eeeeeeeeeeee0000000000000000000000000f00e00000d0c0000a009000080607050000
008090a000b0ddddddd0000000000000000000000000000000000000000000000000eeeeeeeeeee000000000000000f0e00000d0c0000a009000080607050000
008090a000bbcbbb000ddddddddddddd00000000000000000000000000000000000000000000000eeeeeeeeeeee0000fe00000d0c0000a009000800607050000
008090a00b0cccccccbbbbbbbbbb0000ddddddddddddd0000000000000000000000000000000000000000000000eeeeee00000d0c0000a009000800607050000
008090a00b00000000ccccccccccccbbbbbbbbb000000ddddddddddddd000000000000000000000000000000000000000e0000d0c0000a009000806007050000
008090a0b000000000000000000000cccccccccccbbbbbbbbbb0000000dddddddddddd0000000000000000000000000000ee00d0c0000a009000806070050000
008090ab000000000000000000000000000000000ccccccccccccbbbbbbbbb00000000ddddddddddddd00000000000000000e0d0c0000a009000806070050000
008090ab000000000000000000000000000000000000000000000cccccccccccbbbbbbbbbb000000000ddddddddddddd00000ed0c0000a009000806070500000
008090aaaaaa0000000000000000000000000000000000000000000000000000ccccccccccccbbbbbbbbb00000000000ddddddd0c0000a009000806070500000
00809a000000aaaaaaaaaaaa0000000000000000000000000000000000000000000000000000cccccccccccbbbbbbbbbb00000bdc0000a009000806070500000
008099999900000000000000aaaaaaaaaaa0000000000000000000000000000000000000000000000000000ccccccccccccbbbbdc0000a009000806070500000
00809000009999999999900000000000000aaaaaaaaaaaa0000000000000000000000000000000000000000000000000000cccccc0000a009000806070500000
00890000000000000000099999999999000000000000000aaaaaaaaaaa0000000000000000000000000000000000000000000000b0000a009000806070500000
0089000000000000000000000000000099999999990000000000000000aaaaaaaaaaa000000000000000000000000000000000000b000a009000806070500000
008888880000000000000000000000000000000000999999999990000000000000000aaaaaaaaaaaa0000000000000000000000000b00a009000806070500000
080000008888888888880000000000000000000000000000000009999999999900000000000000000aaaaaaaaaaa000000000000000b0a009000806070500000
08000000000000000000888888888880000000000000000000000000000000009999999999900000000000000000aaaaaaaaaaaa0000ba009000806070500000
80000000000000000000000000000008888888888800000000000000000000000000000000099999999999000000000000000000aaaaaa009000806070500000
77777766666000000000000000000000000000000088888888888800000000000000000000000000000000999999999900000000000000a09000806070500000
000000777777777777666660000000000000000000000000000000888888888880000000000000000000000000000000999999999990000a9000806070500000
00000000000000000077777777777766660000000000000000000000000000000888888888888000000000000000000000000000000999999000806070500000
00000000000000000000000000000077777777777766600000000000000000000000000000000888888888880000000000000000000000000900806070500000
55555555555500000000000000000000000000000077777777777766600000000000000000000000000000008888888888800000000000000090806070500000
00000000000055555555555500000000000000000000000000000077777777777766000000000000000000000000000000088888888888800009806070500000
00000000000000000000000055555555555000000000000000000000000000000077777777777760000000000000000000000000000000088888806070500000
00000000000000000000000000000000000555555555555000000000000000000000000000000077777777777700000000000000000000000000086070500000
00000000000000000000000000000000000000000000000555555555550000000000000000000000000000000077777777777700000000000000006070500000
00000000000000000000000000000000000000000000000000000000005555555555550000000000000000000000000000000077777777777700006870500000
44444400000000000000000000000000000000000000000000000000000000000000005555555555550000000000000000000000000000000677777770500000
00000044444444444000000000000000000000000000000000000000000000000000000000000000005555555555500000000000000000000000000600500000
00000000000000000444444444400000000000000000000000000000000000000000000000000000000000000000055555555555500000000000000060500000
00000000000000000000000000044444444444000000000000000000000000000000000000000000000000000000000000000000055555555555500006500000
00000000000000000000000000000000000000444444440000000000000000000000000000000000000000000000000000000000000000000000055555500000

